/*! For license information please see auth_events.js.LICENSE.txt */
(()=>{var e={876:(e,t,s)=>{"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}t.log=function(){var e;return"object"===("undefined"==typeof console?"undefined":i(console))&&console.log&&(e=console).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var s="color: "+this.color;t.splice(1,0,s,"color: inherit");var i=0,n=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(i++,"%c"===e&&(n=i))})),t.splice(n,0,s)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"env"in{env:{NODE_ENV:"production",COMMIT:"6820778c57fa34146bee79b6748b855a0bb03051",VERSION:"2.2.5",CDN_ORIGIN:"https://id.rambler.ru",CDN_PREFIX:"/rambler-id-helper",API_ORIGIN:"https://id.rambler.ru",API_PREFIX:"/api/v3",DEBUG:void 0}}&&(e=void 0),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=s(579)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},579:(e,t,s)=>{"use strict";e.exports=function(e){function t(e){for(var t=0,s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s),t|=0;return i.colors[Math.abs(t)%i.colors.length]}function i(e){var s;function r(){if(r.enabled){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=r,a=Number(new Date),c=a-(s||a);o.diff=c,o.prev=s,o.curr=a,s=a,t[0]=i.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var l=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,s){if("%%"===e)return e;l++;var n=i.formatters[s];if("function"==typeof n){var r=t[l];e=n.call(o,r),t.splice(l,1),l--}return e})),i.formatArgs.call(o,t),(o.log||i.log).apply(o,t)}}return r.namespace=e,r.enabled=i.enabled(e),r.useColors=i.useColors(),r.color=t(e),r.destroy=n,r.extend=o,"function"==typeof i.init&&i.init(r),i.instances.push(r),r}function n(){var e=i.instances.indexOf(this);return-1!==e&&(i.instances.splice(e,1),!0)}function o(e,t){return i(this.namespace+(void 0===t?":":t)+e)}return i.debug=i,i.default=i,i.coerce=function(e){return e instanceof Error?e.stack||e.message:e},i.disable=function(){i.enable("")},i.enable=function(e){var t;i.save(e),i.names=[],i.skips=[];var s=("string"==typeof e?e:"").split(/[\s,]+/),n=s.length;for(t=0;t<n;t++)s[t]&&("-"===(e=s[t].replace(/\*/g,".*?"))[0]?i.skips.push(new RegExp("^"+e.substr(1)+"$")):i.names.push(new RegExp("^"+e+"$")));for(t=0;t<i.instances.length;t++){var o=i.instances[t];o.enabled=i.enabled(o.namespace)}},i.enabled=function(e){if("*"===e[e.length-1])return!0;var t,s;for(t=0,s=i.skips.length;t<s;t++)if(i.skips[t].test(e))return!1;for(t=0,s=i.names.length;t<s;t++)if(i.names[t].test(e))return!0;return!1},i.humanize=s(585),Object.keys(e).forEach((function(t){i[t]=e[t]})),i.instances=[],i.names=[],i.skips=[],i.formatters={},i.selectColor=t,i.enable(i.load()),i}},335:function(e,t){var s;!function(i){"use strict";var n=function(e,t,s){if(!Array.isArray(e))throw new TypeError("each() expects array as first argument");if("function"!=typeof t)throw new TypeError("each() expects function as second argument");"function"!=typeof s&&(s=Function.prototype);var i=e.length;if(0===i)return s(void 0,e);var n=new Array(i),o=0,r=!1;e.forEach((function(e,a){t(e,(function(e,t){if(!r)return e?(r=!0,s(e)):(n[a]=t,(o+=1)===i?s(void 0,n):void 0)}))}))};void 0===(s=function(){return n}.apply(t,[]))||(e.exports=s)}()},585:e=>{var t=1e3,s=60*t,i=60*s,n=24*i,o=7*n;function r(e,t,s,i){var n=t>=1.5*s;return Math.round(e/s)+" "+i+(n?"s":"")}e.exports=function(e,a){a=a||{};var c,l,d=typeof e;if("string"===d&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var r=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(r){var a=parseFloat(r[1]);switch((r[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return a*o;case"days":case"day":case"d":return a*n;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*s;case"seconds":case"second":case"secs":case"sec":case"s":return a*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(e);if("number"===d&&isFinite(e))return a.long?(c=e,(l=Math.abs(c))>=n?r(c,l,n,"day"):l>=i?r(c,l,i,"hour"):l>=s?r(c,l,s,"minute"):l>=t?r(c,l,t,"second"):c+" ms"):function(e){var o=Math.abs(e);return o>=n?Math.round(e/n)+"d":o>=i?Math.round(e/i)+"h":o>=s?Math.round(e/s)+"m":o>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,s),o.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e="ramblerIdHelper",t="ramblerIdHelperSentry",i="ramblerIdHelperTest",n=/^https?:\/\/[^/]+\.rambler\.ru\/?/,o="rambler-id-redirect-auth-is-pending",r=[-11,-4e3,-2e3,-2002,-3e3,"need session","invalid login","rate limit exceed","api does not respond","location does not respond"];var a=s(335),c=s.n(a);const l=(e,t={})=>{const{raw:s}=t;let i;try{const t=(()=>{const e={};if(document.cookie?.length){const t=document.cookie.split(";");for(let s,i=0,n=t.length;i<n;i++)s=t[i].replace(/^(\s|\u00A0)+/g,"").split("="),e[s[0]]=decodeURIComponent(s[1])}return e})()[e];i=s?t:JSON.parse(t??"")}catch{}return i??null},d=(e,t,s={})=>{const{raw:i,expires:n,path:o,domain:r,samesite:a,secure:c}=s;try{let s;"number"==typeof n?(s=new Date,s.setTime(s.getTime()+24*n*60*60*1e3)):s=n;let l=`${e}=${encodeURIComponent(i?String(t):JSON.stringify(t))}`;l+=s?`; expires=${s.toUTCString()}`:"",l+=o?`; path=${o}`:"",l+=r?`; domain=${r}`:"",l+=a?`; samesite=${a}`:"",l+=c?"; secure":"",document.cookie=l}catch{}};class h extends Error{constructor(e){super(),this.name="ApiError",this.message=e.message.toString().toLowerCase(),this.code=e.code??"unknown",this.details=e.details,Object.setPrototypeOf(this,h.prototype)}}Error,Error;const u="rchainid",m={domain:`.${window.location.hostname.split(".").slice(-2).join(".")}`,path:"/",samesite:"none",secure:!0},p=e=>{if(!e)return;let t=e;e instanceof Error&&(t={message:e.message},"code"in e&&(t.code=e.code,t.details=e.details));const s=e instanceof Error&&"need session"!==e.message?1/24/30:1/24/12;d(u,t,{...m,expires:s})},f=(e,t={})=>{const{raw:s}=t;let i;try{const t=window.localStorage.getItem(e);i=s?t:JSON.parse(t??"")}catch{}return i??null},g="undefined"!=typeof window&&window.document&&"requestStorageAccess"in document&&"function"==typeof document.requestStorageAccess,y="id.lenta.ru",w=["secretmag","eda","lenta","afisha","champ","motor","quto","passion","ferra","lentaru","wmj","letidor","indicator","moslenta"],b={default:"id.rambler.ru",secretmag:"id.secretmag.ru",eda:"rid.eda.ru",lenta:y,afisha:"idrambler.afisha.ru",champ:"id.championat.com",motor:"id.motor.ru",quto:"id.quto.ru",passion:"id.passion.ru",ferra:"id.ferra.ru",lentaru:y,wmj:"id.wmj.ru",letidor:"id.letidor.ru",indicator:"id.indicator.ru",moslenta:"id.moslenta.ru",smailbox:"id.smailbox.ru"},C=(e=w)=>[...new Set([b.default,...e.map((e=>b[e])).filter(Boolean)])],E=e=>e.split(".").slice(-2).join("."),v=()=>{if("undefined"==typeof window)return"";const{hostname:e}=window.location,[t]=g?C(Object.keys(b)).filter((t=>E(t)===E(e))):[];return t?`https://${t}`:"https://id.rambler.ru"},L="undefined"!=typeof window?window.navigator?.userAgent:"",O=/(iPhone|iPod|iPad|Macintosh).*AppleWebKit(?!.*Safari)/i.test(L),R=/.*(; wv|Version\/\d\.\d|\.0\.0\.0).*/.test(L),T=/.*mail-native-app.*/i.test(L),I=O||R||T,S=/IEMobile|Windows Phone/i.test(L),x=/iPhone|iPad|iPod/i.test(L)&&!S,F=/Android/i.test(L)&&!S,A=x||F,N=(/Firefox/i.test(L),e=>{const t={};return Object.keys(e).forEach((s=>{null!=e[s]&&(t[s]=e[s])})),t}),k=e=>{const t={},{searchParams:s}=new URL(e);return s.forEach(((e,s)=>{t[s]=e})),t},D=(e,t,s)=>{if(!(Object.keys(t).length||s&&Object.keys(s).length))return e;const{protocol:i,host:n,pathname:o}=new URL(e),r=k(e),a=N({...r,...t}),c=new URLSearchParams(a).toString(),l=c?`?${c}`:"",d=(e=>{const t={},{hash:s}=new URL(e);return new URLSearchParams(s.substring(1)).forEach(((e,s)=>{t[s]=e})),t})(e),h=N({...d,...s}),u=new URLSearchParams(h).toString();return`${i}//${n}${o}${l}${u?`#${u}`:""}`},$=e=>{const{protocol:t,host:s,pathname:i,search:n}=new URL(e);return`${t}//${s}${i}${n}`},P=(e,t,s={})=>{const{raw:i}=s;try{const s=i?String(t):JSON.stringify(t);window.sessionStorage.setItem(e,s)}catch{}},_=(e,t,s={})=>{const{withCredentials:i=!1,headers:n}=s,o=new XMLHttpRequest;o.withCredentials=i,o.open("get",e,!0);for(const e in n)n.hasOwnProperty(e)&&o.setRequestHeader(e,n[e]);o.onreadystatechange=()=>{4===o.readyState&&0!==o.status&&t(null,o.responseText)},o.onerror=()=>{t(new h({message:"location does not respond",code:0,details:{method:e}}))},o.send(null)},U=e=>{let t="";const s=new Uint8Array(e);return crypto.getRandomValues(s),s.forEach((e=>{t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[e%62]})),t},M=()=>U(17),H=v(),B=(e,t,s,i=H)=>{const n=new XMLHttpRequest,o=`${i}/api/v3${e}`,r=`rid${M()}`,a={id:r,params:t};n.open("post",o,!0),n.setRequestHeader("Content-Type","application/json"),n.withCredentials=!0,n.onreadystatechange=()=>{if(4!==n.readyState)return;if(200!==n.status)return;const{success:t,error:i,result:o}=JSON.parse(n.responseText),a=i?.extra?.legacy_error;if(t&&null==a)return void s(null,o);if(null==a)return void s(new h({message:"api failed",code:0,details:{method:e,requestId:r}}));const c=a.errno,l=a.strerror?.toLowerCase();s(new h({message:l,code:c,details:{method:e,requestId:r}}))},n.onerror=()=>{s(new h({message:"api does not respond",code:0,details:{method:e,requestId:r}}))},n.send(JSON.stringify(a))},G=B.bind(null,"/profile/getInfo"),j=B.bind(null,"/legacy/Rambler::Id::destroy_session"),W=B.bind(null,"/session/getRsidx"),z=B.bind(null,"/session/getRccid"),q=B.bind(null,"/legacy/Rambler::Common::get_configuration"),Q=B.bind(null,"/legacy/Rambler::Id::set_rsid_local"),J=B.bind(null,"/legacy/Rambler::Id::Session_copy::create_request");var V;!function(e){e.INSTALL="install",e.INSTALLED="installed",e.ERROR="error",e.REGISTER="register",e.LOGIN="login",e.SELECTPROFILE="selectprofile",e.OAUTHLOGIN="oauthlogin",e.OAUTHERROR="oautherror",e.LOGOUT="logout",e.CLOSE="close",e.REDIRECT="redirect",e.RESIZE="resize",e.LOADED="loaded",e.DESTROY="destroy",e.NAVIGATE="navigate",e.REQUEST_QR_CODE="request_qr_code",e.RESPONSE_QR_CODE="response_qr_code"}(V||(V={}));const Y=[V.INSTALLED,V.REGISTER,V.CLOSE,V.REDIRECT,V.RESIZE,V.LOADED,V.NAVIGATE,V.REQUEST_QR_CODE,V.OAUTHERROR,V.SELECTPROFILE],Z=v();let X,K;const ee=async e=>{Math.random()>1||(X?e(X):K?K.push(e):(K=[e],((e,t)=>{const s=document.createElement("script");s.src="https://id.rambler.ru/rambler-id-helper/2.2.5/sentry.js",s.onload=()=>{t(null),document.body&&document.body.removeChild(s)},s.onerror=()=>{t(new h({message:"script does not loaded"}))},document.body&&document.body.appendChild(s)})(0,(e=>{X?K?.forEach((e=>e(X))):e||(X=window[t],delete window[t],K?.forEach((e=>e(X))))}))))},te={width:750,height:450},se={sberbank:{title:"Сбер ID",width:1024,height:750},apple:{title:"Apple ID",width:650,height:750},livejournal:{title:"LiveJournal",width:750,height:650},pgumosru:{title:"mos.ru",width:750,height:650},google:{title:"Google",width:650,height:700},instagram:{title:"Instagram",width:750,height:650},webauthn:{title:"Электронный ключ",...te},vkontakte:{title:"ВКонтакте",...te},facebook:{title:"Facebook",...te},odnoklassniki:{title:"Одноклассники",...te},mailru:{title:"Mail.Ru",...te},twitter:{title:"Twitter",...te},mail:{title:"С помощью почты"},phone:{title:"По номеру телефона"},championat:{title:"Championat",...te}},ie=Object.keys(se).filter((e=>"mail"!==e&&"phone"!==e));var ne=s(876),oe=s.n(ne);const re=oe()("id:helper:emitter");class ae{constructor(){this.listeners={}}existsListener(e,t){return this.listeners[e]&&-1!==this.listeners[e].indexOf(t)}addListener(e,t){re(`addListener ${e}`),this.listeners[e]=this.listeners[e]||[],"function"!=typeof t||this.existsListener(e,t)||this.listeners[e].push(t)}removeListener(e,t){re(`removeListener ${e}`),this.existsListener(e,t)&&this.listeners[e].splice(this.listeners[e].indexOf(t),1)}emit(e,...t){re(`emit ${e}`),this.listeners[e]&&this.listeners[e].forEach((e=>{e(...t)}))}}const ce=oe()("id:helper:emitter");class le extends ae{constructor(t){super(),this.AUTH_EVENTS=[V.LOGIN,V.OAUTHLOGIN,V.LOGOUT],this.PROPAGATED_EVENTS=[...this.AUTH_EVENTS,...Y,V.RESPONSE_QR_CODE,V.SELECTPROFILE],this.PROPAGATED_EVENTS_ONCE=[V.SELECTPROFILE],this.firstPartyOrigin=v(),this.currentTabId=U(32),this.onMessage=({data:t,origin:s,source:i})=>{if(!t||"object"!=typeof t)return;const{emitter:n,eventType:o,redirectUrl:r,data:a,frameInfo:c=a||{},...l}=t;i&&(l.source=i),n!==e||((e,t)=>{const s="https://id.rambler.ru"!==t||t!==Z;return Y.includes(e)&&s})(o,s)||(!r||"object"!=typeof c||c instanceof Error||(c.redirectUrl=r),this.isAuthEvent(o)?this.emit(o,a,l):this.emit(o,c,r??l))},this.notifyListeners=(e,...t)=>{const{listeners:s}=this;[...s[e]??[]].forEach((e=>{e(...t)}))},this.settings=t,this.install()}get isRamblerOrigin(){return n.test(this.firstPartyOrigin)}install(){this.settings.storage&&(this.storage=document.createElement("iframe"),this.storage.src=`${this.firstPartyOrigin}/rambler-id-helper/2.2.5/storage.html`,this.storage.style.width="0",this.storage.style.height="0",this.storage.style.border="0",this.storage.style.position="absolute",this.storage.style.left="-9999px",this.storage.setAttribute("aria-hidden","true"),this.storage.setAttribute("loading","eager"),this.storage.onload=()=>{const t={eventType:V.INSTALL,emitter:e,data:{providerOrigin:window.location.href}};try{this.storage?.contentWindow?.postMessage(t,this.firstPartyOrigin),this.emit(V.INSTALLED)}catch(e){this.emit(V.ERROR,new Error("storage is not installed"))}},this.storage.onerror=()=>{this.emit(V.INSTALLED),this.emit(V.ERROR,new Error("storage is not loaded"))},document.body&&document.body.appendChild(this.storage)),window.addEventListener("message",this.onMessage,!1)}isAuthEvent(e){return this.AUTH_EVENTS.includes(e)}isPropagatedEvent(e,t){return this.PROPAGATED_EVENTS.includes(e)&&(!this.PROPAGATED_EVENTS_ONCE.includes(e)||!t.tabId)}getBroadcastNodes(e){const t=new URL(this.firstPartyOrigin).hostname.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=new RegExp(`^https?:\\/\\/${t}\\/?`),i=this.isAuthEvent(e)?Array.prototype.slice.call(document.getElementsByTagName("iframe")).filter((e=>n.test(e.src)||s.test(e.src))).map((e=>e.contentWindow)):[],{opener:o,parent:r}=window;return[o,r!==window&&r].concat(i).filter(Boolean)}notifyBroadcastNodes(e,t){try{(t?[t]:this.getBroadcastNodes(e.eventType)).forEach((t=>{t.postMessage(e,"*")}))}catch{}}emit(t,s,i,...n){let o;ce(`emit ${t} %o %o`,s,i);const r=i&&"object"==typeof i?i:{};if(this.isPropagatedEvent(t,r)){const{currentTabId:i,latestEventId:n}=this,{tabId:a=null,time:c=Date.now(),...l}=r,d=`${t}:${c}`;if(d===n)return;const h=!s||"object"!=typeof s||s instanceof Error?{}:s,{silentCurrentTab:u=l.silentCurrentTab,redirectUrl:m=""}=h,p=!a||a===i,f={emitter:e,eventType:t,time:c,data:s,tabId:a||i};if(this.notifyBroadcastNodes(f,r.target),this.latestEventId=d,o=m,p&&u)return}const a=[t,s,(o??"")||i,...n];this.storage?window.setTimeout(this.notifyListeners,10,...a):this.notifyListeners(...a)}destroy(){this.listeners={},this.storage&&(document.body.removeChild(this.storage),delete this.storage),window.removeEventListener("message",this.onMessage,!1)}}const de="https://id.rambler.ru",he="data-id-frame";class ue extends le{get type(){return this.options.container instanceof HTMLElement?"embed":g?"popup":"iframe"}get frame(){return ue.frame}set frame(e){ue.frame=e}get frameUrl(){const{path:e="/login-20/login",container:t,startTime:s,...i}=this.options,{href:n,protocol:o,host:r}=window.location;return i.back??(i.back=n),i.param=this.type,i.iframeOrigin=`${o}//${r}`,D(`${de}${e}`,i,{startTime:s})}constructor(e){super({storage:!1}),this.resize=({height:e})=>{this.container instanceof HTMLElement&&(this.container.style.height=`${e}px`)},this.redirect=(e,t)=>{window.location.href=t},this.close=()=>{const{frame:e,container:t}=this;if(e){if(!(e instanceof HTMLIFrameElement)&&"function"==typeof e.close)return clearInterval(this.closeInterval),e.close(),void window.focus();t instanceof HTMLElement&&"embed"!==this.type&&(t.style.zIndex="-1",t.style.transform="translateY(-100vh)",t.style.opacity="0",document.documentElement instanceof HTMLElement&&(document.documentElement.style.overflow="")),window.focus()}},this.destroy=()=>{this.close();const{frame:e,container:t}=this;e instanceof HTMLIFrameElement&&t instanceof HTMLElement&&("embed"===this.type?setTimeout((()=>{t.removeChild(e),t.removeAttribute(he)}),500):document.body&&document.body.removeChild(t)),delete ue.frame,setTimeout((()=>{this.removeListener(V.RESIZE,this.resize),this.removeListener(V.CLOSE,this.close),this.removeListener(V.REDIRECT,this.redirect)}),0),this.emit(V.DESTROY),super.destroy()},this.configure(e)}showOnLoaded(){const{frame:e,container:t}=this;if(e instanceof HTMLIFrameElement){const s=()=>{this.removeListener(V.LOADED,s),e.style.visibility="",e.style.height="100%",t instanceof HTMLElement&&"embed"!==this.type&&(t.style.zIndex="10000",t.style.transform="translateY(0)",t.style.opacity="1",document.documentElement instanceof HTMLElement&&(document.documentElement.style.overflow="hidden"))};this.addListener(V.LOADED,s)}}configure({...e}){this.options=e,this.container??(this.container=e.container)}attach(){let e=null;try{e=this.frame instanceof HTMLIFrameElement?this.frame.parentElement:null}catch{}if("popup"!==this.type&&this.frame instanceof HTMLIFrameElement&&(null==this.container||this.container instanceof HTMLElement&&this.container===e)){if(this.showOnLoaded(),this.frame.src=this.frameUrl,$(this.frame.src)===$(this.frameUrl)){const e=()=>{this.frame?.removeEventListener("load",e),this.emit(V.LOADED),this.frame?.focus()};this.frame.addEventListener("load",e)}}else if("popup"===this.type){const e=window.innerWidth||document.documentElement.clientWidth||screen.width,t=window.innerHeight||document.documentElement.clientHeight||screen.height,s=e/2-400+window.screenLeft,i=t/2-350+window.screenTop;this.frame=window.open(this.frameUrl,"idFrame",`status=1,toolbar=0,menubar=0,resizable=1,scrollbars=1,width=800px,height=700px,top=${i}px,left=${s}px`)}else this.frame=document.createElement("iframe"),this.frame.src=this.frameUrl,this.frame.frameBorder="0",this.frame.style.visibility="hidden",this.frame.style.width="100%",this.frame.style.display="block",this.frame.setAttribute("loading","eager"),this.container instanceof HTMLElement?(this.frame.style.height="0px",this.container.setAttribute(he,"embed")):(this.container=document.createElement("div"),this.container.style.position="fixed",this.container.style.top="0px",this.container.style.left="0px",this.container.style.right="0px",this.container.style.bottom="0px",this.container.style.zIndex="-1",this.container.style.transform="translateY(-100vh)",this.container.style.opacity="0",this.container.style.transition="all 250ms",this.container.style.overflowY="auto",this.container.style.webkitOverflowScrolling="touch",this.container.setAttribute(he,"own")),this.container.appendChild(this.frame),document.body&&null==this.container.parentElement&&document.body.appendChild(this.container),this.showOnLoaded();"embed"===this.type&&(this.addListener(V.RESIZE,this.resize),this.frame instanceof HTMLIFrameElement&&this.frame.setAttribute("scrolling","no")),this.addListener(V.CLOSE,this.close),this.addListener(V.REDIRECT,this.redirect);const{frame:t}=this;t instanceof HTMLIFrameElement||(clearInterval(this.closeInterval),this.closeInterval=window.setInterval((()=>{t?.closed&&(clearInterval(this.closeInterval),this.emit(V.CLOSE))}),500))}}class me extends le{constructor(e){super({storage:!1}),this.providersOptions=ie.reduce(((e,t)=>({...e,[t]:se[t]})),{}),this.options=e}get windowUrl(){const{targetWindow:e,startTime:t,...s}=this.options;return s.popup??(s.popup=!0),s.on??(s.on="login"),s.back??(s.back=window.location.href),"popup"===s.param&&I&&delete s.popup,D(`${de}/oauth-20/`,s,{startTime:t})}attach(){const{options:e,providersOptions:t,windowUrl:s}=this;if("popup"===e.param&&I)return window.location.href=s,void e.targetWindow?.close();const i=(e.provider??"").startsWith("sberbank")?"sberbank":e.provider,n=t[i]?.height??750,o=t[i]?.width??450;if(e.targetWindow)return e.targetWindow.location.href=s,e.targetWindow.resizeTo(o,n),void e.targetWindow.focus();this.window=window.open(s,"oauthWindow",`status=1,toolbar=0,menubar=0,resizable=1,scrollbars=1,width=${o}px,height=${n}px,top=100px,left=100px`)}destroy(){this.window?.close()}}for(var pe,fe=256,ge=[];fe--;)ge[fe]=(fe+256).toString(16).substring(1);function ye(){var e,t=0,s="";if(!pe||fe+16>256){for(pe=Array(t=256);t--;)pe[t]=256*Math.random()|0;t=fe=0}for(;t<16;t++)e=pe[fe+t],s+=6==t?ge[15&e|64]:8==t?ge[63&e|128]:ge[e],1&t&&t>1&&t<11&&(s+="-");return fe++,s}const we="sberIdNotificationBannerClosed",be="sberIdNotificationBannerCloseCount",Ce={path:"/",domain:window.location.hostname.split(".").slice(-2).join(".")},Ee=[1/12,1,7,28];class ve extends ae{constructor(e){super(),this.onLoginClick=()=>{this.emit("click")},this.onCloseClick=()=>{const e=l(be)??0;d(we,!0,{...Ce,expires:Ee[Math.min(e,3)]}),d(be,e+1,{...Ce,expires:365}),this.destroy()},this.options={...e,fontFamily:e.fontFamily??"Roboto, sans-serif",position:e.position??"bottom-right",autoCloseDuration:e.autoCloseDuration??0,offset:{top:30,left:30,right:30,bottom:30,...e.offset}};const[t,s="bottom"]=this.options.position.split("-").reverse();this.container=document.createElement("div"),this.container.style.position="fixed",this.container.style.opacity="0",this.container.style.background="#fff",this.container.style.border="1px solid #E3E3E3",this.container.style.boxShadow="0px 10px 24px rgba(45, 73, 88, 0.15)",this.container.style.borderRadius=A?"0":"5px",this.container.style.padding="20px",this.container.style.display="flex",this.container.style.width=A?"100%":"auto",this.container.style.boxSizing="border-box",this.container.style.flexDirection="column",this.container.style.fontFamily=this.options.fontFamily,this.container.style.minWidth="320px",this.container.style.transition="opacity 200ms",this.container.style[t]=A?"0":this.options.offset[t]+"px",this.container.style[s]=A?"0":this.options.offset[t]+"px",this.label=document.createElement("div"),this.label.style.fontSize="15px",this.label.style.lineHeight="18px",this.label.style.color="#767676",this.label.style.marginBottom="16px",this.label.style.fontWeight="600",this.label.textContent="Вход по Сбер ID",this.container.appendChild(this.label),this.closeButton=document.createElement("a"),this.closeButton.setAttribute("role","button"),this.closeButton.style.fontSize="0",this.closeButton.style.lineHeight="12px",this.closeButton.style.color="#767676",this.closeButton.style.position="absolute",this.closeButton.style.top="10px",this.closeButton.style.right="10px",this.closeButton.style.cursor="pointer",this.closeButton.style.display="flex",this.closeButton.style.padding="10px",this.closeButton.innerHTML='<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6 4.65094L10.3675 0.282877C10.7431 -0.0927631 11.3485 -0.0942703 11.721 0.27826C12.0961 0.653395 12.0914 1.25686 11.7164 1.63195L7.34886 6L11.7164 10.368C12.0914 10.7431 12.0961 11.3466 11.721 11.7217C11.3485 12.0943 10.7431 12.0928 10.3675 11.7171L6 7.34906L1.63247 11.7171C1.25688 12.0928 0.651469 12.0943 0.278986 11.7217C-0.0960822 11.3466 -0.0914182 10.7431 0.283602 10.368L4.65114 6L0.283602 1.63195C-0.0914182 1.25686 -0.0960822 0.653395 0.278986 0.27826C0.651469 -0.0942703 1.25688 -0.0927631 1.63247 0.282877L6 4.65094Z" fill="currentColor"/></svg>',this.container.appendChild(this.closeButton),this.button=document.createElement("a"),this.button.setAttribute("role","button"),this.button.style.display="flex",this.button.style.alignItems="center",this.button.style.justifyContent="center",this.button.style.textDecoration="none",this.button.style.height="48px",this.button.style.fontSize="16px",this.button.style.fontWeight="400",this.button.style.lineHeight="19px",this.button.style.color="#fff",this.button.style.backgroundColor="#21A038",this.button.style.padding="0 23px",this.button.style.borderRadius="4px",this.button.innerHTML='<svg width="22" height="22" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13 0C16.0927 0 18.9337 1.08103 21.1657 2.88421L18.6371 4.74793C17.0315 3.64848 15.0899 3.00354 13 3.00354C7.48924 3.00354 3.00587 7.48999 3.00587 13.0013C3.00587 18.5126 7.48924 22.9965 13 22.9965C18.5134 22.9965 22.9968 18.5126 22.9968 13.0013C22.9968 12.9118 22.9941 12.8223 22.9924 12.7328L25.7912 10.6699C25.9289 11.4245 26 12.2055 26 13.0013C26 20.1807 20.1795 26 13 26C5.82135 26 0 20.1807 0 13.0013C0 5.81931 5.82135 0 13 0ZM23.2856 5.05241C23.9006 5.84651 24.4262 6.71169 24.8456 7.63565L13.0002 16.3673L8.05093 13.2628V9.52921L13.0002 12.6337L23.2856 5.05241Z" fill="currentColor"/></svg>',this.container.appendChild(this.button),this.buttonText=document.createElement("span"),this.buttonText.style.marginLeft="8px",this.buttonText.textContent=e.displayName?`Войти как ${e.displayName}`:"Войти по Сбер ID",this.button.appendChild(this.buttonText)}attach(){this.button.addEventListener("click",this.onLoginClick),this.closeButton.addEventListener("click",this.onCloseClick),document.body.appendChild(this.container),window.setTimeout((()=>{this.container.style.opacity="1"}),0),this.options.autoCloseDuration&&(this.autoCloseTimeout=window.setTimeout(this.onCloseClick,this.options.autoCloseDuration))}destroy(){clearTimeout(this.autoCloseTimeout),this.container.style.opacity="0",this.button.removeEventListener("click",this.onLoginClick),this.closeButton.removeEventListener("click",this.onCloseClick),this.emit("destroy"),window.setTimeout((()=>{document.body.removeChild(this.container)}),200)}}const Le="unset",Oe=()=>{},Re=e=>{const t=e.debug??k(window.location.href).debug;return t?{debug:t}:{}},Te=1===f("itpRedirectorStageApi")?"/api/itp/v2/test-redirector":"/api/itp/v2/redirector",Ie="https://id.rambler.ru",Se="/rambler-id-helper",xe="https://id.rambler.ru",Fe="2.2.5",Ae=oe()("id:helper");(e=>{if("undefined"==typeof window)return;const{debug:t}=k(window.location.href),s=f("debug",{raw:!0});t&&"string"==typeof t&&s!==t&&(s||t!==Le)&&(t===Le?(e=>{try{window.localStorage.removeItem("debug")}catch{}})():((e,t,s={})=>{const{raw:i}=s;try{const s=i?String(t):JSON.stringify(t);window.localStorage.setItem(e,s)}catch{}})("debug",t,{raw:!0}))})(),Ae(Fe);class Ne extends le{get hasTrackingPrevention(){return g}constructor(){super({storage:!0}),this.Events=V,this.userSession=!1,this.requestQRCode=(e,t)=>{const s="function"==typeof e,i=!!t?.source;(s||i)&&J({domain:window.location.host.replace("www.","")},((s,n)=>{s&&this.emit(V.ERROR,s),i?this.emit(V.RESPONSE_QR_CODE,{response:n,error:s?{...s}:null},{target:t.source}):e({response:n,error:s})}))},this.getAuthQRCode=(e,t)=>{const s=t=>{const{error:i,response:n}=t;i?e(null,new h(i)):e(n),this.removeListener(V.RESPONSE_QR_CODE,s)};t?(this.emit(V.REQUEST_QR_CODE),this.addListener(V.RESPONSE_QR_CODE,s)):this.requestQRCode(s)},this.sendError=e=>{~r.indexOf(e.message)||"code"in e&&e.code&&~r.indexOf(e.code)||ee((t=>{t.withScope((s=>{const i={..."code"in e&&{code:e.code},..."details"in e&&e.details};for(const e in i)i.hasOwnProperty(e)&&s.setExtra(e,i[e]);t.captureException(e)}))}))},this.removeCache=()=>{((e,t={})=>{try{d(e,"",{...t,raw:!0,expires:-1})}catch{}})(u,m)},this.closeAuth=(e=Oe)=>{this.authFrame?.close(),"function"==typeof e&&e()},this.addListener(V.LOGIN,this.removeCache),this.addListener(V.OAUTHLOGIN,this.removeCache),this.addListener(V.LOGOUT,this.removeCache),this.addListener(V.ERROR,this.sendError),this.addListener(V.REQUEST_QR_CODE,this.requestQRCode)}push(e=Oe){e()}logout(e,t=Oe){"function"==typeof e&&(t=e,e=void 0),j({},(s=>{s&&this.emit(V.ERROR,s),this.emit(V.LOGOUT,e),t(null,s)}))}getProfileInfo(e,t=Oe){"function"==typeof e&&(t=e,e={}),G({...e,enc_avatar_url_nonce:M()},((e,s)=>{this.userSession=!!s,e?this.emit(V.ERROR,e):s&&!this.isRamblerOrigin&&(((e,t={})=>{const{raw:s}=t;let i;try{const t=window.sessionStorage.getItem(e);i=s?t:JSON.parse(t??"")}catch{}return i??null})(o)&&this.emit(V.LOGIN),(e=>{try{window.sessionStorage.removeItem(e)}catch{}})(o)),t(s?s.profile:null,e)}))}getSessionToken(e=Oe){W({},((t,s)=>{this.userSession=!!s,t&&this.emit(V.ERROR,t),p(t??s?.result.rccid),e(s?s.result:null,t)}))}getDefaultChainId(e=Oe){const t=(()=>{const e=l(u);if(!e||"string"==typeof e)return e;const{code:t,message:s,details:i}=e;return"details"in e?new h({message:s,code:t,details:i}):new Error(s)})();t instanceof Error?e(null,t):t?e({rccid:t}):z({},((t,s)=>{t&&this.emit(V.ERROR,t),p(t??s?.rccid),e(s?{rccid:s.rccid}:null,t)}))}createPropagationWindow(){return!this.hasTrackingPrevention||O||R?null:window.open(`${Ie}${Se}/${Fe}/noop.html`,"","status=1,toolbar=0,menubar=0,resizable=1,scrollbars=1,width=250px,height=100px,top=100px,left=100px")}propagateSession(e,t={eventType:V.LOGIN},s=Oe){const{eventType:i=V.LOGIN,shortSession:n=!1,propagationWindow:o=null,rname:r,...a}=t;if(a.keepWindow&&(a.data=a.data||{},a.data.keepWindow=a.keepWindow),!this.hasTrackingPrevention)return void q({key:"ServerSideDomains"},((t,n)=>{const o=t?[]:Object.keys(n.configuration).filter((e=>!!n.configuration[e]));c()(o,((t,s)=>{const i=t.split(".").slice(-2).join(".");Q({domain:i,id:e},(()=>s(null)),`https://${t}`)}),(()=>{if(a.back&&!a.popup){const e=()=>{setTimeout((()=>{this.removeListener(i,e),s(),window.location.href=a.back??""}),500)};this.addListener(i,e)}else s();this.emit(i,a.data)}))}));const l=C(r?[r]:void 0);c()(l,((e,t)=>{_(`https://${e}/api/itp/v2/ping`,((s,i)=>{let n;try{n=JSON.parse(i)}catch{}t(null,[e,n?.response,s])}))}),((t,c)=>{const[d]=c.filter((([e])=>e===l[0])).map((([,e])=>e)),u=[],m=[];if(c.forEach((([e,t,s])=>{d&&d===t?u.push(e):m.push(new h({message:s?"redirector are not available":"redirector ping response wrong",code:0,details:{method:`https://${e}/api/itp/v2/ping`,rname:r}}))})),m.length>0&&ee((()=>{m.forEach((e=>this.emit(V.ERROR,e)))})),u.length<2)return void s(new h({message:"redirector are not available",code:0}));const[p=xe.replace(/^https?:\/\//,""),...f]=u,g=`${Ie}${Se}/${Fe}/propagate.html?extra=${encodeURIComponent(JSON.stringify({eventType:i,...a}))}`,y=`https://${p}${Te}?rsid=${e||""}&setShortCookie=`+(n?1:0)+f.map((e=>`&to=${e}`)).join("")+`&back=${encodeURIComponent(g)}`;if(!o)return s(),void(window.location.href=y);const w=()=>{this.removeListener(i,w),s()};this.addListener(i,w),o.location.replace(y)}))}activateCookies(e=Oe){if(window.parent===window)return void e();if(d(i,1,{expires:1/24/6,path:"/",domain:".rambler.ru",samesite:"none",secure:!0}),l(i))return void e();const t=window.open(`${Ie}${Se}/${Fe}/cookies.html`,"","status=1,toolbar=0,menubar=0,resizable=1,scrollbars=1,width=500px,height=300px,top=100px,left=100px"),s=n=>{n.data===i&&(window.removeEventListener("message",s),t?.close(),e())};window.addEventListener("message",s)}getSberIdUserInfo(e=Oe){(e=>{_("https://id.sber.ru/CSAFont/api/userdata?client_id=fbdea60d-1f60-425f-9917-d2fe53b2ac3f",((t,s)=>{e(t,s&&JSON.parse(s))}),{withCredentials:!0,headers:{"Process-ID":ye().replace(/-/g,"")}})})(((t,s)=>{e(s,t)}))}showSberIdNotificationBanner(e){l(we)||this.sberIdBanner||this.userSession||this.getSberIdUserInfo((t=>{if(t&&!this.sberIdBanner&&!this.userSession){const{position:s,fontFamily:i,offset:n,autoCloseDuration:o,...r}=e,a=`${t?.firstname||""} ${t?.surname||""}`.trim();this.sberIdBanner=new ve({position:s,fontFamily:i,offset:n,autoCloseDuration:o,displayName:a}),this.sberIdBanner.attach();const c=()=>{this.openProviderOAuth({...r,action:"login",provider:"sberbank",provider_sso:Boolean(a)})},l=()=>{this.sberIdBanner?.destroy()},d=()=>{this.sberIdBanner?.removeListener("click",c),this.sberIdBanner?.removeListener("destroy",d),this.removeListener(V.LOGIN,l),this.removeListener(V.OAUTHLOGIN,l),delete this.sberIdBanner};this.sberIdBanner.addListener("click",c),this.sberIdBanner.addListener("destroy",d),this.addListener(V.LOGIN,l),this.addListener(V.OAUTHLOGIN,l)}}))}redirectToAuth(e={}){Ae("redirectToAuth %o",e);const{path:t="/login-20/login",...s}=e,i={back:window.location.href,...s,...Re(e)},n={startTime:Date.now()};this.userSession||(i.session=!1);const r=D(`https://id.rambler.ru${t}`,i,n);this.isRamblerOrigin||P(o,!0),window.location.href=r}openAuth(e={},t=Oe){Ae("openAuth %o",e);const s={...e,...Re(e),startTime:Date.now()};if(this.userSession||(s.session=!1),this.authFrame)this.authFrame.configure(s);else{this.authFrame=new ue(s);const e=e=>{"object"==typeof e&&(e?.keepWindow||"registration"===e?.on)||this.authFrame?.destroy()},t=(...e)=>{this.emit(V.CLOSE,...e)},i=()=>{setTimeout((()=>{this.authFrame?.removeListener(V.CLOSE,t),this.authFrame?.removeListener(V.DESTROY,i),this.removeListener(V.LOGIN,e),this.removeListener(V.OAUTHLOGIN,e),delete this.authFrame}),0)};this.authFrame.addListener(V.CLOSE,t),this.authFrame.addListener(V.DESTROY,i),this.addListener(V.LOGIN,e),this.addListener(V.OAUTHLOGIN,e)}const i=()=>{this.authFrame?.removeListener(V.LOADED,i),t()},n=()=>{this.authFrame?.removeListener(V.CLOSE,n),this.authFrame?.removeListener(V.DESTROY,n),this.authFrame?.removeListener(V.LOADED,i)};this.authFrame.addListener(V.CLOSE,n),this.authFrame.addListener(V.DESTROY,n),this.authFrame.addListener(V.LOADED,i),this.authFrame.attach()}openProviderOAuth(e){Ae("openProviderOAuth %o",e);const t=new me({...e,...Re(e),startTime:Date.now()});t.addListener(V.OAUTHERROR,(()=>t.destroy())),t.attach()}redirectToProviderOAuth(e){Ae("redirectToProviderOAuth %o",e);const t={on:"login",back:window.location.href,...e,...Re(e)},s={startTime:Date.now()},i=D("https://id.rambler.ru/oauth-20/",t,s);this.isRamblerOrigin||P(o,!0),window.location.href=i}}const ke=()=>{if(Array.isArray(window[e])||!window[e]){const t=window[e]||[];window[e]=new Ne,t.forEach((e=>e()))}};document.body?ke():document.addEventListener("DOMContentLoaded",ke,!1)})()})();
//# sourceMappingURL=auth_events.js.map